{"version":3,"file":"pillarCalculator.js","sources":["utils/pillarCalculator.js"],"sourcesContent":["// 天干地支对照表\nconst GAN = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸']\nconst ZHI = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥']\n\n// 五行属性对照表\nconst ELEMENT_MAP = {\n    '甲': '木', '乙': '木',\n    '丙': '火', '丁': '火',\n    '戊': '土', '己': '土',\n    '庚': '金', '辛': '金',\n    '壬': '水', '癸': '水',\n    '子': '水', '丑': '土',\n    '寅': '木', '卯': '木',\n    '辰': '土', '巳': '火',\n    '午': '火', '未': '土',\n    '申': '金', '酉': '金',\n    '戌': '土', '亥': '水'\n}\n\n// 计算年柱\nfunction calculateYearPillar(year) {\n    const yearOffset = year - 4 // 以甲子年为基准\n    const ganIndex = yearOffset % 10\n    const zhiIndex = yearOffset % 12\n    return {\n        name: '年柱',\n        time: year + '年',\n        value: GAN[ganIndex] + ZHI[zhiIndex],\n        element: ELEMENT_MAP[GAN[ganIndex]] + ELEMENT_MAP[ZHI[zhiIndex]]\n    }\n}\n\n// 计算月柱\nfunction calculateMonthPillar(year, month) {\n    const yearGan = GAN[(year - 4) % 10]\n    let monthGanIndex = 0\n    \n    // 根据年干确定月干\n    switch(yearGan) {\n        case '甲':\n        case '己':\n            monthGanIndex = 2\n            break\n        case '乙':\n        case '庚':\n            monthGanIndex = 4\n            break\n        case '丙':\n        case '辛':\n            monthGanIndex = 6\n            break\n        case '丁':\n        case '壬':\n            monthGanIndex = 8\n            break\n        case '戊':\n        case '癸':\n            monthGanIndex = 0\n            break\n    }\n    \n    const monthZhiIndex = (month + 1) % 12\n    return {\n        name: '月柱',\n        time: month + '月',\n        value: GAN[monthGanIndex] + ZHI[monthZhiIndex],\n        element: ELEMENT_MAP[GAN[monthGanIndex]] + ELEMENT_MAP[ZHI[monthZhiIndex]]\n    }\n}\n\n// 计算日柱\nfunction calculateDayPillar(date) {\n    // 使用蔡勒公式计算日干支\n    const year = date.getFullYear()\n    const month = date.getMonth() + 1\n    const day = date.getDate()\n    \n    let c = Math.floor(year / 100)\n    let y = year % 100\n    let m = month\n    if (m <= 2) {\n        m += 12\n        y--\n    }\n    \n    const w = (y + Math.floor(y / 4) + Math.floor(c / 4) - 2 * c + Math.floor(26 * (m + 1) / 10) + day - 1) % 60\n    const ganIndex = w % 10\n    const zhiIndex = w % 12\n    \n    return {\n        name: '日柱',\n        time: day + '日',\n        value: GAN[ganIndex] + ZHI[zhiIndex],\n        element: ELEMENT_MAP[GAN[ganIndex]] + ELEMENT_MAP[ZHI[zhiIndex]]\n    }\n}\n\n// 计算时柱\nfunction calculateHourPillar(hour) {\n    const dayGan = GAN[0] // 假设日干为甲\n    let hourGanIndex = 0\n    \n    // 根据日干确定时干\n    switch(dayGan) {\n        case '甲':\n        case '己':\n            hourGanIndex = 0\n            break\n        case '乙':\n        case '庚':\n            hourGanIndex = 2\n            break\n        case '丙':\n        case '辛':\n            hourGanIndex = 4\n            break\n        case '丁':\n        case '壬':\n            hourGanIndex = 6\n            break\n        case '戊':\n        case '癸':\n            hourGanIndex = 8\n            break\n    }\n    \n    const hourZhiIndex = Math.floor((hour + 1) / 2) % 12\n    return {\n        name: '时柱',\n        time: hour + '时',\n        value: GAN[hourGanIndex] + ZHI[hourZhiIndex],\n        element: ELEMENT_MAP[GAN[hourGanIndex]] + ELEMENT_MAP[ZHI[hourZhiIndex]]\n    }\n}\n\n// 计算五行属性\nfunction calculateElements(pillars) {\n    const elementCount = {\n        '木': 0,\n        '火': 0,\n        '土': 0,\n        '金': 0,\n        '水': 0\n    }\n    \n    // 统计五行出现次数\n    pillars.forEach(pillar => {\n        const elements = pillar.element.split('')\n        elements.forEach(element => {\n            elementCount[element]++\n        })\n    })\n    \n    // 计算百分比\n    const total = Object.values(elementCount).reduce((a, b) => a + b, 0)\n    return Object.entries(elementCount).map(([name, count]) => ({\n        name,\n        value: Math.round((count / total) * 100),\n        color: getElementColor(name)\n    }))\n}\n\n// 获取五行颜色\nfunction getElementColor(element) {\n    const colorMap = {\n        '木': '#4CAF50',\n        '火': '#F44336',\n        '土': '#795548',\n        '金': '#FFC107',\n        '水': '#2196F3'\n    }\n    return colorMap[element]\n}\n\n// 主函数\nexport function calculatePillars(birthDate, birthTime) {\n    const date = new Date(birthDate)\n    const [hour, minute] = birthTime.split(':').map(Number)\n    \n    const yearPillar = calculateYearPillar(date.getFullYear())\n    const monthPillar = calculateMonthPillar(date.getFullYear(), date.getMonth() + 1)\n    const dayPillar = calculateDayPillar(date)\n    const hourPillar = calculateHourPillar(hour)\n    \n    const pillars = [yearPillar, monthPillar, dayPillar, hourPillar]\n    const elements = calculateElements(pillars)\n    \n    return {\n        pillars,\n        elements\n    }\n} "],"names":[],"mappings":"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"}